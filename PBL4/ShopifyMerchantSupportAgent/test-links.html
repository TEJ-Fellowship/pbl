<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Source Attribution Links</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .source-card {
        border: 1px solid #ccc;
        margin: 10px 0;
        padding: 15px;
        border-radius: 8px;
      }
      .source-title {
        font-weight: bold;
        margin-bottom: 10px;
      }
      .source-link {
        color: #007bff;
        text-decoration: none;
        margin-right: 10px;
      }
      .source-link:hover {
        text-decoration: underline;
      }
      .test-button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .test-button:hover {
        background: #0056b3;
      }
      .response {
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Test Source Attribution Links</h1>
    <button class="test-button" onclick="testAPI()">Test API Response</button>

    <div id="response" class="response" style="display: none">
      <h3>API Response:</h3>
      <div id="response-content"></div>
    </div>

    <script>
      async function testAPI() {
        try {
          const response = await fetch("http://localhost:3003/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "How do I create a product in Shopify?",
              sessionId: "test-session-" + Date.now(),
            }),
          });

          const data = await response.json();

          document.getElementById("response").style.display = "block";
          document.getElementById("response-content").innerHTML = `
                     <h4>Answer:</h4>
                     <p>${data.answer.substring(0, 200)}...</p>
                     
                     <h4>Sources (${data.sources.length}):</h4>
                     ${data.sources
                       .map(
                         (source) => `
                          <div class="source-card">
                              <div class="source-title">${source.title}</div>
                              <div>Category: ${source.category}</div>
                              <div>Relevance: ${source.relevanceScore}%</div>
                              <div>URL: ${source.url}</div>
                              ${
                                source.anchorTag
                                  ? `<a href="${source.anchorTag}" target="_blank" class="source-link">View Section</a>`
                                  : ""
                              }
                              ${
                                source.url &&
                                source.url !== "N/A" &&
                                !source.anchorTag
                                  ? `<a href="${source.url}" target="_blank" class="source-link">View Source</a>`
                                  : ""
                              }
                          </div>
                     `
                       )
                       .join("")}
                     
                     <h4>Source Attribution Summary:</h4>
                     <p>Total Sources: ${
                       data.sourceAttribution.totalSources
                     }</p>
                     <p>Attribution Rate: ${
                       data.sourceAttribution.attributionSummary.attributionRate
                     }%</p>
                     
                     <h4>Answer with Source Links:</h4>
                     <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                       ${data.sourceAttribution.sentenceAttribution
                         .map(
                           (sentenceData) => `
                             <div style="margin-bottom: 10px;">
                               <span>${sentenceData.sentence}</span>
                               ${
                                 sentenceData.contributingSources.length > 0
                                   ? `
                                 <span style="margin-left: 8px;">
                                   ${sentenceData.contributingSources
                                     .map((sourceId) => {
                                       const source = data.sources.find(
                                         (s) => s.id === sourceId
                                       );
                                       return `
                                       <span style="margin-right: 8px;">
                                         <span style="background: #4caf50; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; margin-right: 4px;">[${sourceId}]</span>
                                         ${
                                           source &&
                                           (source.anchorTag ||
                                             (source.url &&
                                               source.url !== "N/A"))
                                             ? `
                                           <a href="${
                                             source.anchorTag || source.url
                                           }" target="_blank" style="color: #4caf50; text-decoration: none; font-size: 0.9em;">ðŸ”—</a>
                                         `
                                             : ""
                                         }
                                       </span>
                                     `;
                                     })
                                     .join("")}
                                 </span>
                               `
                                   : ""
                               }
                             </div>
                           `
                         )
                         .join("")}
                     </div>
                 `;
        } catch (error) {
          document.getElementById("response").style.display = "block";
          document.getElementById(
            "response-content"
          ).innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }
    </script>
  </body>
</html>
